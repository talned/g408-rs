VLAN 10: 192.168.24.0/24
VLAN 10 GW: 192.168.24.1/24
VLAN 20: 192.168.25.0/24
VLAN 20 GW: 192.168.25.1/24

External: 172.16.25.22/24

##########
# SWITCH #
##########

enable
conf t

vlan 10
 name VLAN10-SERVER
 no shutdown
 exit

vlan 20
 name VLAN20-USERS
 no shutdown
 exit
 
interface range gi1/0/2-5
 switchport mode access
 switchport access vlan 10
 no shutdown
 exit

interface range gi1/0/6-12
 switchport mode access
 switchport access vlan 20
 no shutdown
 exit

interface gi1/0/1
 switchport mode trunk
 switchport trunk allowed vlan 10,20
 no shutdown
 exit

exit
write memory

##########
# ROUTER #
##########

enable
conf t

! Disable HTTP and HTTPS servers to free up ports 80 and 443
no ip http server
no ip http secure-server
ip routing

! ACL Configuration for Inter-VLAN security
ip access-list extended VLAN_SECURITY
 permit tcp 192.168.25.0 0.0.0.255 192.168.24.0 0.0.0.255 eq 80
 permit tcp 192.168.24.0 0.0.0.255 192.168.25.0 0.0.0.255 established
 deny ip 192.168.25.0 0.0.0.255 192.168.24.0 0.0.0.255 log
 deny ip 192.168.24.0 0.0.0.255 192.168.25.0 0.0.0.255 log
 permit ip any any
 exit

! ACL Configuration for NAT
ip access-list standard NAT
 10 permit 192.168.24.0 0.0.0.255
 20 permit 192.168.25.0 0.0.0.255
 exit
 
! Configure trunk interface (physical)
interface gi0/0/0
 no shutdown
 no ip address
 exit

! Configure external interface
interface gi0/1/0
  ip address 172.16.25.22 255.255.255.0
  ip nat outside
  no shutdown
  exit

! Configure VLAN 10 subinterface
interface gi0/0/0.10
 encapsulation dot1Q 10
 ip address 192.168.24.1 255.255.255.0
 ip nat inside
 ip access-group VLAN_SECURITY out
 no shutdown
 exit

! Configure VLAN 20 subinterface
interface gi0/0/0.20
 encapsulation dot1Q 20
 ip address 192.168.25.1 255.255.255.0
 ip nat inside
 ip access-group VLAN_SECURITY out
 no shutdown
 exit
 
! Configure NAT overload (PAT)
ip nat inside source list NAT interface gi0/1/0 overload
! Static NAT for external HTTP access to DMZ web server
ip nat inside source static tcp 192.168.24.23 80 interface gi0/1/0 80
! Default route to tutor's router:
ip route 0.0.0.0 0.0.0.0 172.16.25.5
! Static routes to Organization X networks:
ip route 192.168.16.0 255.255.255.0 172.16.25.45
ip route 192.168.17.0 255.255.255.0 172.16.25.45
!exit config mode
exit

