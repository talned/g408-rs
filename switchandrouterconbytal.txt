|--------------------------------------------------------------------------|
|                                                                          |
|                     Router & Switch Configuration                        |
|                      By Ryan Cassidy, Majak Wel                          |
|                        Written By Talha Ahmed                            |
|                                                                          |
|--------------------------------------------------------------------------|

Duties:
  Ryan Copy and Paste Router Configuration & Verify Applied Configuration
  Majak Copy and Paste Switch Configuration & Verify Applied Configuration

HOW TO COPY-PASTE INTO PUTTY:
1. Highlight the text below from '>>> START COPYING <<<' to '<<< END COPYING >>>'
2. Right-click and select "Copy"
3. In PuTTY, press SHIFT+INSERT to paste

------------------ IP Addresses -------------------------
VLAN 10 (DMZ - Internet Facing): 192.168.16.0/24
  Gateway: 192.168.16.1
  Ubuntu Apache Web Server: 192.168.16.3/24

VLAN 20 (IT - Internal Only): 192.168.17.0/24
  Gateway: 192.168.17.1
  Windows Client: 192.168.17.4/24
  Windows Server: 192.168.17.2/24

External Interface (Internet Facing): 172.16.25.18/24
---------------------------------------------------------

-------------- Router: 172.16.25.18/24 ----------------------------------
############################ WARNING ####################################

⚠️ FOR ROUTER CONFIGURATION - DO THESE STEPS

STEP 1: Ask tutor for their router IP for Cross-Organisation Testing
  Note: Inter-VLAN is Working Well!
  Router IP: 172.16.25.5

STEP 2: Remind tutor to configure on their router and another organisation:
  ip route 192.168.16.0 255.255.255.0 172.16.25.18
  ip route 192.168.17.0 255.255.255.0 172.16.25.18

Tutor's typical setup:
  Gateway: 172.16.25.17
  Windows Client: 172.16.25.19/24
  Subnet Mask: 255.255.255.0

#######################################################################
-----------------------------------------------------------------------

--------- Another Organisation ---------------------------------------
ip route <ORG_X_NETWORK> 255.255.255.0 <ORG_X_ROUTER_IP>
<ORG_X_NETWORK>: 192.168.70.0
<ORG_X_ROUTER_IP>: 172.16.25.45

Static Routes add to router 172.16.25.18
ip route 192.168.70.0 255.255.255.0 172.16.25.45
ip route 192.168.71.0 255.255.255.0 172.16.25.45
---------------------------------------------------------------------

Subnet Mask: 255.255.255.0 | Subnet Value: 24 
Subnet Inverse Mask: 0.0.0.255

############
## SWITCH ##
############

----------------------------------------------------------
NOTE: Before Start Copying Make Sure You're in User Mode!
      You should see 'Switch>' before you start copying
----------------------------------------------------------

>>> START COPYING <<<

! Start Configuration
enable
conf t
! Setting Up VLAN 10
vlan 10
 name DMZ
 no shutdown
 exit
! Setting Up VLAN 20
vlan 20
 name IT
 no shutdown
 exit
! Assigning port 2 to vlan 10
interface gi1/0/2
 switchport mode access
 switchport access vlan 10
 no shutdown
 exit
! Assigning port 3 & 4 to vlan 20
interface range gi1/0/3-5
 switchport mode access
 switchport access vlan 20
 no shutdown
 exit
! Trunking VLAN 10 & 20 to port 1
interface gi1/0/1
 switchport mode trunk
 switchport trunk allowed vlan 10,20
 switchport trunk native vlan 1
 no shutdown
 exit
! Exit Config Mode
exit

<<< END COPYING >>>

! Adding Configuration to Switch
exit
write memory

VERIFY:
! Required for quick verification
show vlan brief
show interface gi1/0/1 trunk
show spanning-tree vlan 10,20

! Unknown Problem Occurs, Use these for verification
show interface gi1/0/1 switchport
show interface gi1/0/2 switchport
show interface gi1/0/3 switchport
show interface gi1/0/4 switchport

############
## ROUTER ##
############

----------------------------------------------------------
NOTE: Before Start Copying Make Sure You're in User Mode!
      You should see 'Router>' before you start copying
----------------------------------------------------------

>>> START COPYING <<<

! Start Configuration
enable
conf t
! Disable HTTP and HTTPS servers to free up ports 80 and 443
no ip http server
no ip http secure-server
ip routing
! ACL Configuration for Inter-VLAN security
ip access-list extended VLAN_SECURITY_POLICY
 10 permit tcp 192.168.17.0 0.0.0.255 192.168.16.0 0.0.0.255 eq 80
 20 permit tcp 192.168.17.0 0.0.0.255 192.168.16.0 0.0.0.255 eq 443
 30 permit tcp 192.168.16.0 0.0.0.255 192.168.17.0 0.0.0.255 established
 exit
! ACL Configuration for NAT
ip access-list standard NAT_INTERNAL_NETWORKS
 10 permit 192.168.16.0 0.0.0.255
 20 permit 192.168.17.0 0.0.0.255
 exit
! Configure trunk interface (physical)
interface gi0/0/0
 no shutdown
 no ip address
 exit
! Configure external interface
interface gi0/1/0
  ip address 172.16.25.18 255.255.255.0
  ip nat outside
  no shutdown
  exit
! Configure VLAN 10 subinterface
interface gi0/0/0.10
 encapsulation dot1Q 10
 ip address 192.168.16.1 255.255.255.0
 ip nat inside
 no shutdown
 exit
! Configure VLAN 20 subinterface
interface gi0/0/0.20
 encapsulation dot1Q 20
 ip address 192.168.17.1 255.255.255.0
 ip nat inside
 no shutdown
 exit
! Configure NAT overload (PAT)
ip nat inside source list NAT_INTERNAL_NETWORKS interface gi0/1/0 overload
! Static NAT for external HTTP access to DMZ web server
ip nat inside source static tcp 192.168.16.3 80 interface gi0/1/0 80
! Static NAT for external HTTPS access to DMZ web server
ip nat inside source static tcp 192.168.16.3 443 interface gi0/1/0 443
! Default route to tutor's router:
ip route 0.0.0.0 0.0.0.0 172.16.25.5
! Static routes to Organization X networks:
ip route 192.168.70.0 255.255.255.0 172.16.25.45
ip route 192.168.71.0 255.255.255.0 172.16.25.45
! Exit Config Mode
exit

<<< END COPYING >>>

! Applying ACL:
interface gi0/0/0.10
 ip access-group VLAN_SECURITY_POLICY out
 exit

interface gi0/0/0.20
 ip access-group VLAN_SECURITY_POLICY out
 exit

! Adding Configuration to Router
exit
write memory

VERIFY:
! Required for quick verification
show ip interface brief
show ip route
show ip access-lists
show ip nat statistic
show ip nat translations
ping 192.168.16.1
ping 192.168.17.1

! Verify if the access-lists have been properly entered:
show access-lists VLAN_SECURITY_POLICY
show access-lists NAT_INTERNAL_NETWORKS

! Unknown Problem Occurs, Use these for verification
show control-plane host open-ports
show running-config interface gi0/0/0
show running-config interface gi0/0/0.10
show running-config interface gi0/0/0.20
